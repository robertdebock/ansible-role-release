---
# tasks file for server
- name: load packages
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}-{{ ansible_distribution_version }}.yml"
    - "{{ ansible_distribution }}-{{ ansible_distribution_major_version }}.yml"

- name: install software (yum)
  yum:
    name: "{{ item }}"
  with_items:
    - "{{ packages }}"
  notify:
    - reboot
    - wait for the machine to be down
    - wait for the machine to be up
  when:
    - ansible_pkg_mgr == "yum"

- name: install software (dnf)
  dnf:
    name: "{{ item }}"
  with_items:
    - "{{ packages }}"
  notify:
    - reboot
    - wait for the machine to be down
    - wait for the machine to be up
  when:
    - ansible_pkg_mgr == "dnf"

- name: install software (apt)
  apt:
    name: "{{ item }}"
  with_items:
    - "{{ packages }}"
  notify:
    - reboot
    - wait for the machine to be down
    - wait for the machine to be up
  when:
    - ansible_pkg_mgr == "apt"

- name: install software (zypper)
  zypper:
    name: "{{ item }}"
  with_items:
    - "{{ packages }}"
  notify:
    - reboot
    - wait for the machine to be down
    - wait for the machine to be up
  when:
    - ansible_pkg_mgr == "zypper"

- name: install software (pacman)
  pacman:
    name: "{{ item }}"
  with_items:
    - "{{ packages }}"
  notify:
    - reboot
    - wait for the machine to be down
    - wait for the machine to be up
  when:
    - ansible_pkg_mgr == "pacman"

- name: install software (package)
  yum:
    name: "{{ item }}"
  with_items:
    - "{{ packages }}"
  notify:
    - reboot
    - wait for the machine to be down
    - wait for the machine to be up
  when:
    - ansible_pkg_mgr != "yum"
    - ansible_pkg_mgr != "apt"
